@{
    ViewData["Title"] = "User Dashboard";
}

<div class="user-dashboard">
    <!-- Welcome Section -->
    <div class="welcome-section">
        <h1>Welcome back, @ViewData["Username"]!</h1>
        <p class="welcome-subtitle">
            <i class="fas fa-video"></i> Continue your streaming journey
        </p>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-history"></i>
            </div>
            <div class="stat-info">
                <h3>@ViewBag.WatchHistory?.Count</h3>
                <p>In Progress</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-heart"></i>
            </div>
            <div class="stat-info">
                <h3>0</h3>
                <p>Favorites</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3>0h</h3>
                <p>Watch Time</p>
            </div>
        </div>
    </div>

    <!-- Continue Watching -->
    @if (ViewBag.WatchHistory != null && ViewBag.WatchHistory.Count > 0)
    {
        <div class="section-card">
            <div class="section-header">
                <h2><i class="fas fa-play-circle"></i> Continue Watching</h2>
                <a href="@Url.Action("Videos", "User")" class="view-all">View All</a>
            </div>
            <div class="videos-grid">
                @foreach (var video in ViewBag.WatchHistory)
                {
                    <div class="video-card">
                        <a href="@Url.Action("Watch", "User", new { id = video.VideoId })">
                            <div class="thumbnail">
                                <img src="@(video.ThumbnailPath ?? "/images/default-thumbnail.jpg")" alt="@video.Title" />
                                <div class="duration">@TimeSpan.FromSeconds(video.Duration ?? 0).ToString(@"mm\:ss")</div>
                                <div class="progress-bar">
                                    <div class="progress" style="width: 45%"></div>
                                </div>
                            </div>
                            <div class="video-info">
                                <h4>@video.Title</h4>
                                <p class="model-name">@video.Model?.Name</p>
                                <div class="video-meta">
                                    <span><i class="fas fa-eye"></i> @video.Views</span>
                                    <span>•</span>
                                    <span>45% watched</span>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Recommended For You -->
    @if (ViewBag.RecommendedVideos != null && ViewBag.RecommendedVideos.Count > 0)
    {
        <div class="section-card">
            <div class="section-header">
                <h2><i class="fas fa-star"></i> Recommended For You</h2>
            </div>
            <div class="videos-grid">
                @foreach (var video in ViewBag.RecommendedVideos)
                {
                    <div class="video-card">
                        <a href="@Url.Action("Watch", "User", new { id = video.VideoId })">
                            <div class="thumbnail">
                                <img src="@(video.ThumbnailPath ?? "/images/default-thumbnail.jpg")" alt="@video.Title" />
                                <div class="duration">@TimeSpan.FromSeconds(video.Duration ?? 0).ToString(@"mm\:ss")</div>
                            </div>
                            <div class="video-info">
                                <h4>@video.Title</h4>
                                <p class="model-name">@video.Model?.Name</p>
                                <div class="video-meta">
                                    <span><i class="fas fa-eye"></i> @video.Views</span>
                                    <span>•</span>
                                    <span>@video.UploadedAt.ToString("MMM dd")</span>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Browse Models -->
    <div class="section-card">
        <div class="section-header">
            <h2><i class="fas fa-users"></i> Browse Models</h2>
            <a href="@Url.Action("Videos", "User")" class="view-all">View All</a>
        </div>
        <div class="models-grid">
            @foreach (var Model in ViewBag.Models)
            {
                <div class="model-card">
                    <a href="@Url.Action("ModelVideos", "User", new { modelId = Model.ModelId })">
                        <div class="model-image">
                            <img src="@(Model.ProfilePic ?? "/images/default-model.jpg")" />
                        </div>
                        <h3>@Model.Name</h3>
                        <p>@(Model.Videos?.Count ?? 0) Videos</p>
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<style>
.user-dashboard {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.welcome-section {
    text-align: center;
    padding: 30px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
    margin-bottom: 30px;
}

.welcome-section h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.welcome-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
}

.quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.quick-stats .stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    border: 1px solid #e2e8f0;
}

.quick-stats .stat-icon {
    width: 50px;
    height: 50px;
    background: #3b82f6;
    color: white;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
}

.quick-stats .stat-info h3 {
    margin: 0;
    font-size: 1.5rem;
    color: #1e293b;
}

.quick-stats .stat-info p {
    margin: 5px 0 0;
    color: #64748b;
    font-size: 0.9rem;
}

.section-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    border: 1px solid #e2e8f0;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f1f5f9;
}

.section-header h2 {
    margin: 0;
    font-size: 1.4rem;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 10px;
}

.view-all {
    color: #3b82f6;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
}

.view-all:hover {
    text-decoration: underline;
}

.videos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 25px;
}

.video-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s;
    border: 1px solid #e2e8f0;
}

.video-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    border-color: #3b82f6;
}

.video-card a {
    text-decoration: none;
    color: inherit;
}

.thumbnail {
    position: relative;
    height: 140px;
    background: #000;
}

.thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.duration {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 11px;
}

.progress-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.2);
}

.progress {
    height: 100%;
    background: #3b82f6;
}

.video-info {
    padding: 15px;
}

.video-info h4 {
    margin: 0 0 5px;
    font-size: 0.95rem;
    color: #1e293b;
    line-height: 1.3;
}

.model-name {
    color: #3b82f6;
    font-size: 0.85rem;
    font-weight: 500;
    margin: 5px 0;
}

.video-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #64748b;
    font-size: 0.8rem;
    margin-top: 8px;
}

.models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
}

.model-card {
    text-align: center;
    padding: 20px;
    border-radius: 12px;
    background: #f8fafc;
    border: 2px solid transparent;
    transition: all 0.3s;
}

.model-card:hover {
    border-color: #3b82f6;
    transform: translateY(-3px);
    background: white;
}

.model-card a {
    text-decoration: none;
    color: inherit;
}

.model-image {
    width: 100px;
    height: 100px;
    margin: 0 auto 15px;
}

.model-image img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.model-card h3 {
    margin: 0 0 5px;
    font-size: 1.1rem;
    color: #1e293b;
}

.model-card p {
    margin: 0;
    color: #64748b;
    font-size: 0.9rem;
}

</style>

<script>
// User dashboard specific JavaScript
$(document).ready(function() {
    // Add to favorites functionality (placeholder)
    $('.video-card').on('click', '.favorite-btn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const btn = $(this);
        const isFavorite = btn.hasClass('active');
        
        if (isFavorite) {
            btn.removeClass('active').html('<i class="far fa-heart"></i>');
            showToast('Removed from favorites', 'info');
        } else {
            btn.addClass('active').html('<i class="fas fa-heart"></i>');
            showToast('Added to favorites', 'success');
        }
    });
    
    // Watch later functionality (placeholder)
    $('.video-card').on('click', '.watch-later-btn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const btn = $(this);
        btn.toggleClass('active');
        
        if (btn.hasClass('active')) {
            showToast('Added to watch later', 'success');
        } else {
            showToast('Removed from watch later', 'info');
        }
    });
});

function showToast(message, type) {
    // Simple toast notification
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Show toast
    setTimeout(() => toast.classList.add('show'), 10);
    
    // Remove after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Add some CSS for toast
const toastCSS = `
.toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: white;
    border-radius: 8px;
    padding: 12px 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-left: 4px solid #3b82f6;
    transform: translateX(100%);
    transition: transform 0.3s;
    z-index: 1000;
    min-width: 250px;
}

.toast.show {
    transform: translateX(0);
}

.toast-success {
    border-left-color: #10b981;
}

.toast-info {
    border-left-color: #3b82f6;
}

.toast-content {
    display: flex;
    align-items: center;
    gap: 10px;
}

.toast-content i {
    font-size: 1.2rem;
}

.toast-success .toast-content i {
    color: #10b981;
}

.toast-info .toast-content i {
    color: #3b82f6;
}
`;

// Add toast CSS to page
const style = document.createElement('style');
style.textContent = toastCSS;
document.head.appendChild(style);
</script>